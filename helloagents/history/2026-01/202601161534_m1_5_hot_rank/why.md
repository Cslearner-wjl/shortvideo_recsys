# 变更提案：M1.5 热门榜单（热度计算 + Redis 缓存）

目录：`helloagents/plan/202601161534_m1_5_hot_rank/`

---

## 背景与问题

当前系统已具备视频互动行为采集与计数聚合（`video_stats`），但缺少统一的“热门榜单”能力：

- 不能按可解释的热度模型对全站视频排序；
- 缺少缓存层支撑高频访问（榜单页通常读多写少）；
- 缺少可复现的验收流程（创建数据→刷新→查看榜单）。

---

## 目标（成功标准）

1. 提供可配置的热度公式，基于播放/点赞/评论/收藏计数计算 `hot_score`。
2. 定时任务每 N 分钟批量刷新：更新 `video_stats.hot_score`，并同步到 Redis ZSET `hot:videos`。
3. 提供公开只读接口 `GET /api/rank/hot`，分页返回热门视频列表（包含基础信息 + 统计字段）。
4. 提供参数配置方式（`application.yml`）与可复现验收脚本。

---

## 非目标（明确不做）

- 不接入 Spark/Streaming；
- 不做复杂时间衰减（可作为可选项/后续扩展）；
- 不在本阶段实现“多榜单（按分类/地区/标签）”。

---

## 风险与缓解

- **Redis 不可用导致榜单不可用**
  - 缓解：接口在缓存缺失时降级为数据库 `hot_score` 排序（读路径兜底）。
- **定时刷新批量更新压力**
  - 缓解：仅写入 TopN 到 ZSET；刷新间隔可配置；后续可增量刷新。
- **测试环境不具备 Redis**
  - 缓解：`test` profile 关闭调度并使用内存榜单缓存实现；仍覆盖核心逻辑与接口返回。

