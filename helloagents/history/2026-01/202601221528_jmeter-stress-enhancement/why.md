# 变更提案: JMeter 压测加强（混合场景/摸高/浸泡）

## 需求背景
现有压测脚本主要覆盖简单读流量，无法反映真实用户的混合行为，也无法定位系统极限吞吐与长期稳定性风险。需要增强 JMeter 脚本与执行流程，形成可复用的三阶段压测与详细报告。

## 变更内容
1. 构建混合场景事务控制器（读/点赞/评论/发评）
2. 引入阶梯加压摸高测试与自动停止条件
3. 引入浸泡测试流程与报告输出
4. 输出详细压测报告至 `docs/tests/jmeter`

## 影响范围
- **模块:** tests/jmeter、docs/tests/jmeter、scripts
- **文件:** `tests/jmeter/backend_api.jmx`、`docs/tests/jmeter/*.md`、`scripts/*.sh`
- **API:** `/api/videos/page`、`/api/videos/{id}/like`、`/api/videos/{id}/comments`、`/api/auth/login`
- **数据:** 使用现有数据库视频数据，动态抽取视频 ID

## 核心场景

### 需求: 混合场景构建
**模块:** tests/jmeter
构建符合真实用户行为的混合事务。

#### 场景: 读写混合比例
80% 浏览视频流，10% 点赞，5% 查看评论，5% 发表评论。
- 预期结果: 各类请求按权重执行且可复用同一登录态

### 需求: 摸高测试
**模块:** scripts / tests/jmeter
阶梯加压寻找系统吞吐上限。

#### 场景: 100 线程起步，逐分钟 +50
自动迭代并在响应时间 > 500ms 或错误率 > 1% 时停止。
- 预期结果: 记录最大稳定吞吐区间与停止原因

### 需求: 浸泡测试
**模块:** scripts / docs/tests/jmeter
对稳定负载进行 30+ 分钟持续压测。

#### 场景: 峰值 70% 并发运行 30+ 分钟
- 预期结果: 输出稳定性指标、错误率与资源走势结论

## 风险评估
- **风险:** 压测对环境造成负载冲击，可能影响同机服务
- **缓解:** 默认指向本地/测试环境；提供停止阈值与独立报告输出路径
