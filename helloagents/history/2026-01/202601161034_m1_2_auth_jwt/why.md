# 变更提案: M1.2 用户注册/登录 + JWT 鉴权

## 需求背景
当前系统已具备工程骨架与数据库迁移机制，但缺少“用户体系”的闭环能力：注册、登录、鉴权与当前用户信息读取。该能力是后续 M1（刷视频、互动、榜单、推荐）所有写操作与个性化逻辑的前置依赖。

本变更在不实现管理员功能、不做前端的前提下，落地：
- 用户注册（含邮箱验证码）
- 用户登录（账号三选一：用户名/邮箱/手机号）
- JWT 鉴权（`GET /api/users/me`）
- 冻结用户限制（禁止登录；并在写操作时统一拦截）

## 变更内容
1. 新增邮箱验证码“最小实现”（写入表 + 控制台打印；有效期 5 分钟）。
2. 新增注册/登录接口与请求校验（手机号 11 位、邮箱格式、唯一性、验证码校验）。
3. 引入最小化 JWT 鉴权（Spring Security 最小配置 + 自定义 JWT 过滤器）。
4. 新增 `GET /api/users/me`（需要 JWT）。
5. 新增单元/集成测试：至少覆盖注册、登录、冻结。
6. 更新接口文档与错误码说明。

## 影响范围
- **模块:** backend / docs / 数据库迁移
- **API:** 新增 auth/users 相关接口
- **数据:** 新增验证码表；更新 users 表使用约定（status=冻结）

## 核心场景

### 需求: 邮箱验证码
**模块:** backend
用户注册前可请求邮箱验证码，验证码 5 分钟有效。

#### 场景: 发送验证码（最小实现）
输入邮箱地址。
- 服务生成验证码写入数据库并打印到控制台
- 5 分钟后验证码失效

### 需求: 用户注册
**模块:** backend
使用用户名/手机号/邮箱/密码/邮箱验证码注册新用户。

#### 场景: 成功注册
邮箱验证码有效且未使用；用户名/手机号/邮箱唯一。
- 创建 `users` 记录（password_hash 为 bcrypt）
- 返回 JWT 与用户信息（最小字段）

### 需求: 用户登录
**模块:** backend
使用账号（用户名/邮箱/手机号）+ 密码登录。

#### 场景: 登录失败提示
账号不存在或密码错误。
- 返回 “账号或密码错误”

#### 场景: 冻结用户禁止登录
用户 status=冻结。
- 禁止登录（返回对应错误码）

### 需求: 获取当前用户
**模块:** backend
`GET /api/users/me` 必须携带 JWT。
- 返回当前用户信息

## 风险评估
- **风险:** JWT 密钥泄露
  - **缓解:** 仅在本地/训练环境提供默认值，生产必须通过环境变量注入；禁止提交真实密钥
- **风险:** 验证码泄露
  - **缓解:** 最小实现仅用于实训；默认不在响应中回传验证码，仅打印到控制台

