# 变更提案：M1.6 规则推荐（阶段1）

目录：`helloagents/plan/202601180946_m1_6_rule_reco_stage1/`

---

## 背景与问题

当前系统已有用户行为采集（`user_actions`）与视频统计（`video_stats`），但缺少“可用的推荐入口”：

- 新用户没有个性化推荐，无法启动冷启动体验；
- 老用户的行为无法转化为可解释的偏好画像；
- 无去重策略，可能重复推荐用户已经看过/强互动过的视频；
- 缺少可验证的 demo 与测试，难以快速迭代。

---

## 目标（成功标准）

1. 新增 `GET /api/recommendations`，支持分页/滚动参数（`page/pageSize` 或 `cursor`）。
2. 新用户：使用热门榜单 TopN + 随机补齐。
3. 老用户：基于 `user_actions` 计算标签偏好画像，优先推荐同标签视频；混入部分热门与随机。
4. 去重：过滤用户最近 N 条行为中出现的视频（避免“已看过/强互动”的视频被再次推荐）。
5. 提供可复现 demo（插入行为→推荐变化）与单元测试。

---

## 非目标（明确不做）

- 不引入 Spark/ML、Embedding、复杂特征工程；
- 不做复杂时间衰减与在线学习；
- 不引入多维度重排（例如 CTR/完播率模型等）。

---

## 风险与缓解

- **标签字段格式不统一（JSON/字符串）**
  - 缓解：在推荐服务中做容错解析（JSON array / 逗号分隔 / 空值）。
- **SQL JSON 查询在 H2 与 MySQL 兼容性差**
  - 缓解：阶段1 使用“候选池内存过滤”替代 JSON_CONTAINS 等数据库特性。
- **推荐结果不稳定影响滚动体验**
  - 缓解：使用基于 `userId + cursor` 的固定随机种子，保证同一请求参数下输出稳定。

