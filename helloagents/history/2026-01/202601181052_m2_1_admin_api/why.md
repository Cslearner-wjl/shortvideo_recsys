# 变更提案: M2.1 管理后台接口（用户管理/看板）

## 需求背景
当前管理后台仅具备视频审核/热榜刷新等基础能力，缺少用户管理与看板数据接口，无法支撑运营侧的账号治理与数据监控需求。

## 产品分析

### 目标用户与场景
- **用户群体:** 运营/管理员
- **使用场景:** 日常查看用户状态、处理异常账号、监控播放与活跃指标
- **核心痛点:** 用户状态不可控、缺少趋势与热点数据支撑决策

### 价值主张与成功指标
- **价值主张:** 统一管理后台接口，提升运营效率与风险处置能力
- **成功指标:** 用户状态可查询/可冻结；看板接口可提供稳定的时间序列与热门榜单数据

### 人文关怀
严格权限控制，仅提供汇总与必要字段，避免暴露敏感信息。

## 变更内容
1. 新增用户管理接口（查询、冻结/解封）
2. 新增看板统计接口（每日播放、用户增长、活跃用户、热门 TopN）
3. 补充集成测试与 API 文档

## 影响范围
- **模块:** backend
- **文件:** 管理后台控制器/服务/Mapper/DTO、测试代码、H2 测试库 schema
- **API:**
  - GET `/api/admin/users`
  - PATCH `/api/admin/users/{id}/status`
  - GET `/api/admin/analytics/daily-play`
  - GET `/api/admin/analytics/user-growth`
  - GET `/api/admin/analytics/hot-topn`
  - GET `/api/admin/analytics/active-users`
- **数据:** `users`, `user_actions`, `video_stats`, `videos`

## 核心场景

### 需求: 用户管理
**模块:** backend
为运营提供用户查询与冻结/解封能力。

#### 场景: 查询用户列表
管理员输入关键词并分页检索，支持账号/用户名/手机号/邮箱精确或模糊匹配。
- 返回分页列表与总数

#### 场景: 冻结/解封用户
管理员更新用户状态，冻结后账号不可登录。
- 状态更新可追溯

### 需求: 看板统计
**模块:** backend
提供播放趋势、用户增长、活跃与热门榜单数据。

#### 场景: 每日播放趋势
按日期聚合播放次数，支持时间区间查询。

#### 场景: 用户增长
按日期统计新增用户数，支持时间区间查询。

#### 场景: 活跃用户
按日期统计活跃用户数（去重），支持时间区间查询。

#### 场景: 热门 TopN
按热度指标输出 TopN 视频，支持 N 参数限制。

## 风险评估
- **风险:** 时间区间查询导致全表扫描 → **缓解:** 统一时间范围校验，使用已有索引字段
- **风险:** 管理端接口权限缺失 → **缓解:** 复用 `ROLE_ADMIN` 权限链路并补充测试
- **风险:** 参数不合法导致异常 → **缓解:** 统一参数校验并返回 `BAD_REQUEST`

