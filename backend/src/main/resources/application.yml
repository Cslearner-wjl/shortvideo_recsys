server:
  port: ${SERVER_PORT:8080}

app:
  jwt:
    secret: ${JWT_SECRET:dev-secret-change-me}
    issuer: ${JWT_ISSUER:shortvideo-recsys}
    ttl-seconds: ${JWT_TTL_SECONDS:604800}
  minio:
    endpoint: ${MINIO_ENDPOINT:http://127.0.0.1:9000}
    access-key: ${MINIO_ACCESS_KEY:minioadmin}
    secret-key: ${MINIO_SECRET_KEY:minioadmin123}
    bucket: ${MINIO_BUCKET:shortvideo}
    public-endpoint: ${MINIO_PUBLIC_ENDPOINT:${MINIO_ENDPOINT:http://127.0.0.1:9000}}
  hot-rank:
    enabled: ${HOT_RANK_ENABLED:false}
    refresh-interval-ms: ${HOT_RANK_REFRESH_INTERVAL_MS:300000}
    topn: ${HOT_RANK_TOPN:1000}
    redis-key: ${HOT_RANK_REDIS_KEY:hot:videos}
    cache: ${HOT_RANK_CACHE:redis}
    managed-by-streaming: ${HOT_RANK_MANAGED_BY_STREAMING:false}
    stats-hash-prefix: ${HOT_RANK_STATS_HASH_PREFIX:stats:video:}
    weights:
      play: ${HOT_RANK_W_PLAY:1.0}
      like: ${HOT_RANK_W_LIKE:3.0}
      comment: ${HOT_RANK_W_COMMENT:5.0}
      favorite: ${HOT_RANK_W_FAVORITE:4.0}
  recommendations:
    enabled: ${RECO_ENABLED:false}
    candidate-pool-size: ${RECO_CANDIDATE_POOL_SIZE:2000}
    recent-actions-limit: ${RECO_RECENT_ACTIONS_LIMIT:200}
    top-tags: ${RECO_TOP_TAGS:5}
    tag-ratio: ${RECO_TAG_RATIO:0.7}
    hot-ratio: ${RECO_HOT_RATIO:0.2}
    random-ratio: ${RECO_RANDOM_RATIO:0.1}
    random-seed: ${RECO_RANDOM_SEED:2026}
    als:
      enabled: ${RECO_ALS_ENABLED:false}
      redis-prefix: ${RECO_ALS_REDIS_PREFIX:rec:user:}
      topn: ${RECO_ALS_TOPN:50}
    action-weights:
      favorite: ${RECO_W_FAVORITE:4}
      comment: ${RECO_W_COMMENT:3}
      like: ${RECO_W_LIKE:2}
      play: ${RECO_W_PLAY:1}
  behavior-log:
    enabled: ${BEHAVIOR_LOG_ENABLED:true}
    path: ${BEHAVIOR_LOG_PATH:./logs/behavior-events.log}

spring:
  application:
    name: shortvideo-recsys-backend
  profiles:
    default: local
  servlet:
    multipart:
      enabled: true
      max-file-size: 100MB
      max-request-size: 100MB

management:
  endpoints:
    web:
      exposure:
        include: health,info
  endpoint:
    health:
      probes:
        enabled: true

mybatis-plus:
  configuration:
    map-underscore-to-camel-case: true

---
# local：M0 默认配置。强调“能跑起来”，不强制连接数据库。
spring:
  config:
    activate:
      on-profile: local
  autoconfigure:
    exclude:
      - org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration
      - org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration
      - org.springframework.boot.autoconfigure.data.redis.RedisRepositoriesAutoConfiguration
  flyway:
    enabled: false

---
# docker：用于与 deploy/docker-compose.yml 联动（M1+ 可逐步启用真实依赖）。
spring:
  config:
    activate:
      on-profile: docker
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://${MYSQL_HOST:127.0.0.1}:${MYSQL_PORT:3307}/${MYSQL_DATABASE:shortvideo_recsys}?useUnicode=true&characterEncoding=utf8&useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=Asia/Shanghai
    username: ${MYSQL_USER:app}
    password: ${MYSQL_PASSWORD:apppass}
  data:
    redis:
      host: ${REDIS_HOST:127.0.0.1}
      port: ${REDIS_PORT:6379}
  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true
    validate-on-migrate: true

app:
  hot-rank:
    enabled: ${HOT_RANK_ENABLED:true}
  recommendations:
    enabled: ${RECO_ENABLED:true}
